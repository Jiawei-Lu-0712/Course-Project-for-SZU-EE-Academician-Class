# 软件开发手册
当前BSP适配MRS v191  

## 环境准备
小麻雀处理器的软件开发环境非常非常简单。  
小麻雀处理器提供了完整BSP，并依赖于MounRiver Studio(MRS)集成开发环境，开箱即用。  
1. 进入[MRS官网](http://www.mounriver.com/)，下载并安装最新版MRS  
2. 打开`/bsp/bsp_app/SparrowRV_APP.wvproj`，开始开发程序吧！  

![快速开始_下载工程](/doc/图库/使用手册/MRS主界面.png)  

## BSP目录结构
```
├─bsp_app
│  ├─app
│  ├─example
│  ├─lib
│  │  ├─driver
│  │  ├─perip
│  │  └─startup
│  └─obj
├─bsp_iap
│  ├─app_sd
│  ├─app_uart
│  ├─lib
│  └─obj
└─OpenOCD
```
- bsp_app  
面向一般的软件开发场景，包含了启动文件、链接脚本、外设驱动、常用例程。  
`app`目录下包含了`main.c`和`trap_handler.c`，分别用于主程序开发和中断服务程序开发。  
`lib`是底层驱动程序，完成上电初始化、底层硬件操作和驱动、中断处理等功能。`startup`是上电初始化相关的程序。`perip`将底层硬件操作封装为抽象的函数，供上层软件调用。`driver`提供的软件驱动程序，是对`perip`的进一步的封装。  
`example`提供了常见例程；使用例程需要将`app`目录**排除编译**，选择相应的例程目录并**参与编译**。  
`obj`存放了编译生成的临时文件。  

- bsp_iap  
面向在应用编程(In Application Programming, IAP)程序的一种特殊APP，通常固化在FPGA内部，用于从外部存储器加载APP程序。  
原理可查看[IAP启动手册](/doc/使用手册/IAP启动手册.md)  
    - app_sd  
功能是从SD卡加载程序，搬移至iram的相应空间。驱动程序经过大幅度裁剪，以保证占用空间尽可能小。  
    - app_uart  
待开发  

## 开发流程
准备好开发环境后，打开工程。  
选择参与编译的`app`或`example/xxx`源文件，两个目录不能同时参与编译。  



## JTAG+OpenOCD调试
JTAG调试上位机，支持`DAPLink v1/v2` `CH347`，`CH347`稍微有点问题。  
功能很少，不支持GDB，不推荐使用。  
详细内容查看[OpenOCD常见操作](/bsp/OpenOCD/OpenOCD常见操作.md)  


